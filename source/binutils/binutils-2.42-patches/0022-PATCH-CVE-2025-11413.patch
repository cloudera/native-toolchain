Backport of:

From 72efdf166aa0ed72ecc69fc2349af6591a7a19c0 Mon Sep 17 00:00:00 2001
From: Alan Modra <amodra@gmail.com>
Date: Thu, 25 Sep 2025 10:41:32 +0930
Subject: [PATCH] Re: elf: Disallow the empty global symbol name

sparc64-linux-gnu  +FAIL: selective2
sparc64-linux-gnu  +FAIL: selective3

	PR ld/33456
	* elflink.c (elf_link_add_object_symbols): Move new check later
	to give the backend add_symbol_hook a chance to remove symbols
	with empty names.
---
 bfd/elflink.c | 14 +++++++-------
 1 file changed, 7 insertions(+), 7 deletions(-)

--- binutils-2.42.orig/bfd/elflink.c
+++ binutils-2.42/bfd/elflink.c
@@ -5001,6 +5001,13 @@ elf_link_add_object_symbols (bfd *abfd,
 	    continue;
 	}
 
+      if (name[0] == '\0')
+	{
+	  _bfd_error_handler (_("%pB: corrupt symbol table"), abfd);
+	  bfd_set_error (bfd_error_bad_value);
+	  goto error_free_vers;
+	}
+
       /* Sanity check that all possibilities were handled.  */
       if (sec == NULL)
 	abort ();
